# 섹션 3. 회원 관리 예제
## 1. MVC 패턴
### MVC 패턴

![image](https://github.com/Learn-Java-Spring-Team3/spring-study/assets/128376848/a816992d-e1a8-476a-8f8a-4080fd84381e)

사용자가 controller를 조작

-> controller는 model을 통해서 데이터를 가져옴

-> controller는 그 정보를 바탕으로 시각적인 표현을 담당하는 View를 제어해서 사용자에게 전달


- model: data의 가공을 책임짐 (데이터베이스, 처음의 정의하는 상수, 초기화값, 변수 등)
- view: input 텍스트, 체크박스 항목 등과 같은 사용자 인터페이스 요소 (input/output)
- controller: data-user 인터페이스를 잇는 다리 역할 (사용자가 발생시키는 이벤트를 처리하는 역할)

### spring의 MVC
![image](https://github.com/Learn-Java-Spring-Team3/spring-study/assets/128376848/474e9dd1-787a-4acf-b9c2-2ec21c8d8467)

-----

## 2. 비즈니스 요구사항 정리
- data: 회원 ID, 이름
- 기능: 회원 등록, 조회

![image](https://github.com/Learn-Java-Spring-Team3/spring-study/assets/128376848/3b001b8e-c419-4330-a668-8bd1363aecfe)

- 컨트롤러
  * MVC(Model-View-Controller)
  * Controller는 화면(View)와 비즈니스 로직(Model)을 연결시키는 역할
  * 사용자가 화면(view)에서 입력 등의 이벤트를 함 -> 그 이벤트에 맞는 화면(view)나 비즈니스 로직(Model)을 실행할 수 있도록 업데이트
- 서비스
  * 핵심 비즈니스 로직 (비즈니스 도메인 객체 사용하여 구성)
  * eg) 회원은 중복 가입이 안 된다.
- 도메인
  * 비즈니스 도메인 객체
  * 데이터베이스에 저장하고 관리됨
  * eg) 회원, 주문, 쿠폰 등
- 리포지토리
  * 데이터베이스에 접근
  * 도메인 객체를 DB에 저장하고 관리

 ![image](https://github.com/Learn-Java-Spring-Team3/spring-study/assets/128376848/cb1ef2fb-913c-485a-899a-20133ba3ae32)
- 아직 데이터 저장소가 선정되지 않아서, 우선 인터페이스로 구현 클래스를 변경할 수 있도록 설계
- 데이터 저장소는 RDB, NoSQL 등등 다양한 저장소를 고민중인 상황으로 가정
- 개발을 진행하기 위해서 초기 개발 단계에서는 구현체로 가벼운 메모리 기반의 데이터 저장소 사용
-----
## 3. 회원 도메인과 레포지토리 만들기

### 1) 사용할 데이터(= 멤버) 선언 [Member.java]

src - main - java - hello.hello-spring - domain - Member

    package hello.hellospring.domain;
    public class Member {
     
     private Long id;
     private String name;
     public Long getId() {
     return id;
     }
     public void setId(Long id) {
     this.id = id;
     }
     public String getName() {
     return name;
     }
     public void setName(String name) {
     this.name = name;
     }
    }
### 2) 기능 선언 [MemberRepository.java]

src - main - java - hello.hello-spring - repository - MemberRepository (interface)

    package hello.hellospring.repository;
   
    // 회원 객체를 저장하는 repository
   
    import hello.hellospring.domain.Member;
   
    import javax.swing.text.html.Option;
    import java.util.List;
    import java.util.Optional;
   
    public interface MemberRepository {
        Member save(Member member); // 회원 저장 -> 저장된 회원 반환
        Optional<Member> findById(Long id); // ID로 member를 찾음
        // Optional: 없으면 NULL인데, NULL을 반환할 때 Optional로 감싸서 반환
        Optional<Member> findByName(String name); // name으로 menber를 찾음
        List<Member> findAll(); // 전체 member 반환
   
    }

### 3) 기능 구현[MemoryMemberRepository.java]

rc - main - java - hello.hello-spring - repository - MemoryMemberRepository (class)

    package hello.hellospring.repository;
   
    import hello.hellospring.domain.Member;
   
    import java.util.*;
   
    public abstract class MemoryMemberRepository implements MemberRepository {
   
        // Map에 member save
        private static Map<Long, Member> store = new HashMap<>();
        private static long sequence = 0L; // key 값(id)을 생성
        @Override
        public Member save(Member member) {
            member.setId((++sequence));
            store.put(member.getId(), member); // store(member가 save되는 MAP)에 member 저장
            return member;
        }
   
        @Override
        public Optional<Member> findById(Long id) {
            return Optional.ofNullable(store.get(id)); // NULL일 가능성이 있으면 Optional로 감싸서 반환
        }
   
        @Override
        public Optional<Member> findByName(String name) {
            return store.values().stream()
                    .filter(member -> member.getName().equals(name))
                    .findAny();
        }
   
        @Override
        public List<Member> findAll() {
            return new ArrayList<>(store.values());
        }
    }

-----
## 4. 회원 레포지토리 테스트 케이스 작성

1) main 메서드로 실행
2) 웹 어플리케이션의 controller
3) JUnit이라는 프레임워크로 test code를 만들어서 test code를 실행 (★)

src - test - java - hello - hellospring - repository


![image](https://github.com/Learn-Java-Spring-Team3/spring-study/assets/128376848/8a6d4129-16f6-44bd-be3d-9c136b989ec6)

-> 이걸 누르면 동시에 test를 모두 실행할 수 있음

cf) test가 한번 끝나면 repository를 지워줘야 함
-----
## 5. 회원 서비스 개발
    package hello.hellospring.service;
    import hello.hellospring.domain.Member;
    import hello.hellospring.repository.MemberRepository;
    import java.util.List;
    import java.util.Optional;
    public class MemberService {
     private final MemberRepository memberRepository = new
    MemoryMemberRepository();
     /**
     * 회원가입
     */
     public Long join(Member member) {
     validateDuplicateMember(member); //중복 회원 검증
     memberRepository.save(member);
     return member.getId();
     }
     private void validateDuplicateMember(Member member) {
     memberRepository.findByName(member.getName())
     .ifPresent(m -> {
     throw new IllegalStateException("이미 존재하는 회원입니다.");
     });
     }
     /**
     * 전체 회원 조회
     */
     public List<Member> findMembers() {
     return memberRepository.findAll();
     }
     public Optional<Member> findOne(Long memberId) {
     return memberRepository.findById(memberId);
     }
    }
-----
6. 회원 서비스 테스트

        package hello.hellospring.service;
        import hello.hellospring.domain.Member;
        import hello.hellospring.repository.MemoryMemberRepository;
        import org.junit.jupiter.api.BeforeEach;
        import org.junit.jupiter.api.Test;
        import static org.assertj.core.api.Assertions.*;
        import static org.junit.jupiter.api.Assertions.*;
        class MemberServiceTest {
         MemberService memberService;
         MemoryMemberRepository memberRepository;
         @BeforeEach
         public void beforeEach() {
         memberRepository = new MemoryMemberRepository();
         memberService = new MemberService(memberRepository);
         }
         @AfterEach
         public void afterEach() {
         memberRepository.clearStore();
         }
         @Test
         public void 회원가입() throws Exception {
         //Given
         Member member = new Member();
         member.setName("hello");
         //When
         Long saveId = memberService.join(member);
         //Then
         Member findMember = memberRepository.findById(saveId).get();
         assertEquals(member.getName(), findMember.getName());
         }
         @Test
         public void 중복_회원_예외() throws Exception {
         //Given
         Member member1 = new Member();
         member1.setName("spring");
         Member member2 = new Member();
         member2.setName("spring");
         //When
         memberService.join(member1);
         IllegalStateException e = assertThrows(IllegalStateException.class,
         () -> memberService.join(member2));//예외가 발생해야 한다.
         assertThat(e.getMessage()).isEqualTo("이미 존재하는 회원입니다.");
         }
        }
      
